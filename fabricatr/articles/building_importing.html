<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Aaron Rudkin">
<title>DeclareDesign - Building and Importing Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-search/autocomplete.umd.js"></script><script src="../../site_libs/quarto-search/fuse.min.js"></script><script src="../../site_libs/quarto-search/quarto-search.js"></script><meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><script src="../../site_libs/quarto-html/anchor.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <img src="../../static/dd-logo-sm.svg" alt=""><span class="navbar-title"><strong>Declare</strong>Design</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../getting-started.html">Getting started</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://book.declaredesign.org">Book</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-software" role="button" data-bs-toggle="dropdown" aria-expanded="false">Software</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-software">
<li>
    <a class="dropdown-item" href="../../declaredesign/">
 <span class="dropdown-text">DeclareDesign</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../fabricatr/">
 <span class="dropdown-text">fabricatr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../randomizr/">
 <span class="dropdown-text">randomizr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../estimatr/">
 <span class="dropdown-text">estimatr</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Building and Importing Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aaron Rudkin </p>
          </div>
  </div>
    
    
  </div>
  

</header><div class="cell">

</div>
<p><strong>fabricatr</strong> is a package designed to help you imagine your data before you collect it. While many solutions exist for creating simulated datasets, <strong>fabricatr</strong> is specifically designed to make the creation of realistic social science datasets easy. In particular, we need to be able to imagine <em>correlated</em> data and <em>hierarchical</em> data.</p>
<section id="basics" class="level1"><h1>Basics</h1>
<p>Using <strong>fabricatr</strong> begins by calling the function <code><a href="//reference/fabricate.html">fabricate()</a></code>. <code><a href="//reference/fabricate.html">fabricate()</a></code> can be used to create single-level of hierarchical data. There are three main ways to call <code><a href="//reference/fabricate.html">fabricate()</a></code>:</p>
<ul>
<li>Making a single-level dataset by specifying how many observations you would like</li>
<li>Making a single-level dataset by importing data and optionally modifying it by creating new variables</li>
<li>Making a hierarchical dataset.</li>
</ul></section><section id="single-level-datasets-from-scratch" class="level1"><h1>Single-level datasets from scratch</h1>
<p>Making a single-level dataset begins with providing the argument <code>N</code>, a number representing the number of observations you wish to create, followed by a series of variable definitions. Variables can be defined using any function you have access to in R. <strong>fabricatr</strong> provides several simple functions for generating common types of data. These are covered below. Functions that create subsequent variables can rely on previously created variables, which ensures that variables can be related to one another:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/fabricatr/">fabricatr</a></span><span class="op">)</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">5</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, Y2 <span class="op">=</span> <span class="va">Y</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">my_data</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: right;">Y</th>
<th style="text-align: right;">Y2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">3.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">2.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">2.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">1.6</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This simple example makes use of <code>R</code>’s built-in <code>runif</code> command. The rest of the tutorial assumes a familiarity with <code>R</code> and its basic data generating processes.</p>
</section><section id="filling-out-observations." class="level1"><h1>Filling out observations.</h1>
<p><code>fabricate</code> is intended to make rectangular data frames: this means that each variable added at a level needs to be the same length. Failure to provide equal-length variables will result in an error. We provide a convenient helper function, <code>recycle</code>, to help expand existing data to fit the length of your level. Here, let’s use the existing <code>month</code> variable from <code>R</code> to generate data using a month:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month_gdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  month_name <span class="op">=</span> <span class="fu"><a href="//reference/recycle.html">recycle</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">)</span>,</span>
<span>  gdp_growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><code>month.abb</code> contains the months of the year: [“Jan”, “Feb”, “Mar”, …, “Dec”]. It is obvious that although we are asking for 20 observations, there are only twelve months in the year. <code>recycle</code> will automatically wrap the month text resulting in a data frame with the 12 months “Jan” through “Dec”, followed by 8 months “Jan” through “Aug”.</p>
</section><section id="single-level-datasets-using-existing-data" class="level1"><h1>Single-level datasets using existing data</h1>
<p>Instead of specifying the argument <code>N</code>, users can specify the argument <code>data</code> to import existing datasets. Once a dataset is imported, subsequent variables have access to <code>N</code>, representing the number of observations in the imported data. This makes it easy to augment existing data with simulations based on that data.</p>
<p>In this example, we make use of the <code>quakes</code> dataset, built into <code>R</code>, which describes characteristics of earthquakes off the coast of Fiji. The <code>mag</code> variable in this dataset contains the richter magnitude of the earthquakes. We will expand this data to add variables modelling hypothetical fatalities and insurance costs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_quake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">quakes</span>,</span>
<span>  fatalities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="va">mag</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  insurance_cost <span class="op">=</span> <span class="va">fatalities</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1000000</span>, <span class="fl">2000000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">simulated_quake_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: right;">lat</th>
<th style="text-align: right;">long</th>
<th style="text-align: right;">depth</th>
<th style="text-align: right;">mag</th>
<th style="text-align: right;">stations</th>
<th style="text-align: right;">fatalities</th>
<th style="text-align: right;">insurance_cost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-20</td>
<td style="text-align: right;">182</td>
<td style="text-align: right;">562</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">494</td>
<td style="text-align: right;">564,736,181</td>
</tr>
<tr class="even">
<td style="text-align: right;">-21</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">650</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">390</td>
<td style="text-align: right;">414,044,159</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-26</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">596</td>
<td style="text-align: right;">708,701,956</td>
</tr>
<tr class="even">
<td style="text-align: right;">-18</td>
<td style="text-align: right;">182</td>
<td style="text-align: right;">626</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">293</td>
<td style="text-align: right;">567,537,664</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-20</td>
<td style="text-align: right;">182</td>
<td style="text-align: right;">649</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">487</td>
<td style="text-align: right;">920,442,976</td>
</tr>
<tr class="even">
<td style="text-align: right;">-20</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">319</td>
<td style="text-align: right;">436,673,133</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice that variable creation calls are able to make reference to both the variables in the imported data set, and newly created variables. Also, function calls can be arbitrarily nested – the variable fatalities uses several nested function calls.</p>
</section><section id="hierarchical-data" class="level1"><h1>Hierarchical data</h1>
<p>The most powerful use of <strong>fabricatr</strong> is to create hierarchical (“nested”) data. In the example below, we create 5 countries, each of which has 10 provinces. We also have covariates at the country level (GDP per capita and life expectancy) and at the provincial level (presence of natural resources, and presence of manufacturing industry):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      gdp_per_capita <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, min <span class="op">=</span> <span class="fl">10000</span>, max <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span>,</span>
<span>      life_expectancy <span class="op">=</span> <span class="fl">50</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">gdp_per_capita</span> <span class="op">&gt;</span> <span class="fl">30000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    provinces <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      natural_resources <span class="op">=</span> <span class="fu"><a href="//reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.3</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>      manufacturing <span class="op">=</span> <span class="fu"><a href="//reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.7</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 21%">
<col style="width: 16%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">countries</th>
<th style="text-align: right;">gdp_per_capita</th>
<th style="text-align: right;">life_expectancy</th>
<th style="text-align: left;">provinces</th>
<th style="text-align: right;">natural_resources</th>
<th style="text-align: right;">manufacturing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">03</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">04</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Several things can be observed in this example. First, fabricate knows that your second <code><a href="//reference/fabricate.html">add_level()</a></code> command will be nested under the first level of data. Each level gets its own ID variable, in addition to the variables you create. Second, the meaning of the variable “N” changes. During the <code><a href="//reference/fabricate.html">add_level()</a></code> call for countries, N is 5. During the <code><a href="//reference/fabricate.html">add_level()</a></code> call for provinces, N is 10. And the resulting data, of course, has 50 observations.</p>
<p>Finally, the province-level variables are created using the <code><a href="//reference/draw_discrete.html">draw_binary()</a></code> function. This is a function provided by <strong>fabricatr</strong> to make simulating discrete random variables simple. When you simulate your own data, you can use <strong>fabricatr</strong>’s functions, R’s built-ins, or any custom functions you wish. <code><a href="//reference/draw_discrete.html">draw_binary()</a></code> is explained in <a href="../../r/fabricatr/articles/variable_generation.html">our tutorial on variable generation using <strong>fabricatr</strong></a></p>
</section><section id="adding-hierarchy-to-existing-data" class="level1"><h1>Adding hierarchy to existing data</h1>
<p><strong>fabricatr</strong> is also able to import existing data and nest hierarchical data under it. This maybe be useful if, for example, you have existing country-level data but wish to simulate data at lower geographical levels for the purposes of an experiment you plan to conduct.</p>
<p>Imagine importing the country-province data simulated in the previous example. Because <code><a href="//reference/fabricate.html">fabricate()</a></code> returns a data frame, this simulated data can be re-imported into a subsequent fabricate call, just like external data can be.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citizen_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">country_data</span>,</span>
<span>    citizens <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span></span>
<span>        <span class="va">N</span>,</span>
<span>        mean <span class="op">=</span> <span class="va">gdp_per_capita</span> <span class="op">+</span> <span class="va">natural_resources</span> <span class="op">*</span> <span class="fl">5000</span> <span class="op">+</span> <span class="va">manufacturing</span> <span class="op">*</span> <span class="fl">5000</span>,</span>
<span>        sd <span class="op">=</span> <span class="fl">10000</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">citizen_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">countries</th>
<th style="text-align: right;">gdp_per_capita</th>
<th style="text-align: right;">life_expectancy</th>
<th style="text-align: left;">provinces</th>
<th style="text-align: right;">natural_resources</th>
<th style="text-align: right;">manufacturing</th>
<th style="text-align: left;">citizens</th>
<th style="text-align: right;">salary</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">001</td>
<td style="text-align: right;">45,852</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">002</td>
<td style="text-align: right;">56,768</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">003</td>
<td style="text-align: right;">52,549</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">004</td>
<td style="text-align: right;">46,428</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">005</td>
<td style="text-align: right;">70,148</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">006</td>
<td style="text-align: right;">64,771</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In this example, we add a third level of data; for each of our 50 country-province observations, we now have 10 citizen-level observations. Citizen-level covariates like salary can draw from both the country-level covariate and the province-level covariate.</p>
<p>Notice that the syntax for adding a new nested level to existing data is different than the syntax for adding new variables to the original dataset.</p>
</section><section id="modifying-existing-levels" class="level1"><h1>Modifying existing levels</h1>
<p>Suppose you have hierarchical data, and wish to simulate variables at a higher level of aggregation. For example, imagine you import a dataset containing citizens within countries, but you wish to simulate additional country-level variables. In <strong>fabricatr</strong>, you can do this using the <code><a href="//reference/fabricate.html">modify_level()</a></code> command.</p>
<p>Let’s use our country-province data from earlier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_country_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">country_data</span>,</span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">modify_level</a></span><span class="op">(</span>average_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">30</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">new_country_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 19%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">countries</th>
<th style="text-align: right;">gdp_per_capita</th>
<th style="text-align: right;">life_expectancy</th>
<th style="text-align: left;">provinces</th>
<th style="text-align: right;">natural_resources</th>
<th style="text-align: right;">manufacturing</th>
<th style="text-align: right;">average_temperature</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">03</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">69</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">04</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">40,451</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">65</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can observe that the new variable is created at the level of aggregation you chose – countries. Also, although N is not specified anywhere, <code><a href="//reference/fabricate.html">modify_level()</a></code> knows how large N should be based on the number of countries it finds in the dataset. It is important, then, to ensure that the <code><a href="//reference/fabricate.html">modify_level()</a></code> command is correctly assigned to the level of interest. We can also modify more than one level.</p>
<p>Here, we modify our country-province-citizen data from above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_citizen_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">citizen_data</span>,</span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">modify_level</a></span><span class="op">(</span>average_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">30</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    provinces <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">modify_level</a></span><span class="op">(</span></span>
<span>      conflict_zone <span class="op">=</span> <span class="fu"><a href="//reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span><span class="va">N</span>, prob <span class="op">=</span> <span class="fl">0.2</span> <span class="op">+</span> <span class="va">natural_resources</span> <span class="op">*</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>      infant_mortality <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="va">conflict_zone</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span></span>
<span>        <span class="op">(</span><span class="va">average_temperature</span> <span class="op">&gt;</span> <span class="fl">70</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span></span>
<span>    <span class="op">)</span>,</span>
<span>    citizens <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">modify_level</a></span><span class="op">(</span></span>
<span>      college_degree <span class="op">=</span> <span class="fu"><a href="//reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span><span class="va">N</span>, prob <span class="op">=</span> <span class="fl">0.4</span> <span class="op">-</span> <span class="op">(</span><span class="fl">0.3</span> <span class="op">*</span> <span class="va">conflict_zone</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<p>Before assessing what this tells us about <code><a href="//reference/fabricate.html">modify_level()</a></code>, let’s consider what the data simulated does. It creates a new variable at the country level, for a country level average temperature. Subsequently, it creates a province level binary indicator for whether the province is an active conflict site. Provinces that have natural resources are more likely to be in conflict in this simulation, drawing on conclusions from literature on “resource curses”. The infant mortality rate for the province is able to depend both on province level data we have just generated, and country-level data: it is higher in high-temperature areas (reflecting literature on increased disease burden near the equator) and also higher in conflict zones. Citizen access to education is also random, but depends on whether they live in a conflict area.</p>
<p>There are a lot of things to learn from this example. First, it’s possible to modify multiple levels. Any new variable created will automatically propagate to the lower level data according – by setting an average temperature for a country, all provinces, and all citizens of those provinces, have the value for the country. Values created from one <code><a href="//reference/fabricate.html">modify_level()</a></code> call can be used in subsequent variables of the same call, or subsequent calls.</p>
<p>Again, we see the use of <code><a href="//reference/draw_discrete.html">draw_binary()</a></code>. Using this function is covered in our tutorial on <a href="../../r/fabricatr/articles/variable_generation.html">generating discrete random variables</a>, linked below.</p>
</section><section id="averages-within-higher-levels-of-hierarchy" class="level1"><h1>Averages within higher levels of hierarchy</h1>
<p>A powerful feature of nested data and <strong>fabricatr</strong>’s setup is that variable creating can access variables from higher in</p>
<p>You may want to include the mean value of a variable within a group defined by a higher level of the hierarchy, for example the average income of citizens within city. You can do this with <code><a href="https://rdrr.io/r/stats/ave.html">ave()</a></code>, a built-in <code>R</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ave_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="//reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  cities <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">add_level</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  citizens <span class="op">=</span> <span class="fu"><a href="//reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>    income_mean_city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">cities</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ave_example</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: left;">cities</th>
<th style="text-align: left;">citizens</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">income_mean_city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">-1.39</td>
<td style="text-align: right;">-1.39</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1.62</td>
<td style="text-align: right;">0.73</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here, we can create citizen-level data which relies on the data of other citizens within the same city. <code><a href="https://rdrr.io/r/stats/ave.html">ave()</a></code> takes two arguments: first, the name of the variable we are averaging on (in this case, <code>income</code>), and second, the name of the level we are grouping by (in this case <code>cities</code>). Other <code>R</code> functions which are able to group by variables to compute statistics of interest are also compatible with <strong>fabricatr</strong>.</p>
</section><section id="next-steps" class="level1"><h1>Next Steps</h1>
<p>You’ve seen <strong>fabricatr</strong>’s ability to generate single-level and hierarchical data, which is enough to get you started on using the package. From here, you can explore more about modeling the structure of data by reading our <a href="../../r/fabricatr/articles/cross_classified.html">tutorial on panel and cross-classified data</a> or <a href="../../r/fabricatr/articles/resampling.html">using <strong>fabricatr</strong> to bootstrap or resample hierarchical data</a>. Or, if you would like to learn about modeling specific variables using <strong>fabricatr</strong>, you can read our tutorial on <a href="../../r/fabricatr/articles/common_social.html">common social science variables</a>; our technical manual on <a href="../../r/fabricatr/articles/variable_generation.html">generating discrete random variables</a>; or our guide on <a href="../../r/fabricatr/articles/other_packages.html">using other data generation packages</a> with <strong>fabricatr</strong>.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body>
</html>
